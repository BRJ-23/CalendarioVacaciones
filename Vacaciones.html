<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vacaciones 2026</title>
    <style>
        :root {
            --holiday-color: #e74c3c; /* Rojo festivo */
            --convenio-color: #e67e22; /* Naranja convenio */
            --weekend-bg: #f8f9fa;
            --prio-color: #0d47a1; /* Azul Oscuro */
            --flex-color: #81d4fa; /* Azul Claro */
            --border-color: #ddd;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            padding: 20px;
            text-align: center;
        }

        h1 { color: #333; margin-bottom: 20px; }

        /* --- ESTILOS DEL PANEL DE CONTROL --- */
        .control-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto 30px auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .inputs-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .input-group label {
            font-size: 0.85em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }

        .input-group input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: 80px;
            text-align: center;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            background: #eee;
            padding: 10px;
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }

        .mode-btn.active {
            box-shadow: 0 0 0 2px #333;
            transform: scale(1.05);
        }

        /* Colores de los botones */
        .btn-prio { background-color: var(--prio-color); color: white; }
        .btn-flex { background-color: var(--flex-color); color: #003; }
        .btn-erase { background-color: #bdc3c7; color: #333; }
        .btn-save { background-color: #27ae60; color: white; margin-left: 10px; }
        .btn-load { background-color: #8e44ad; color: white; }

        .counters {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        /* --- ESTILOS DEL CALENDARIO --- */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .month {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            padding-bottom: 15px;
        }

        .month-header {
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .month-header.next-year { background-color: #8e44ad; }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            padding: 10px;
            font-size: 0.9em;
        }

        .day-name {
            font-weight: bold;
            color: #7f8c8d;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 5px;
        }

        .day {
            padding: 8px 0;
            border-radius: 4px;
            margin: 1px;
            cursor: pointer;
            user-select: none;
        }

        .day:hover { background-color: #eee; }

        /* Estados especiales */
        .weekend { background-color: var(--weekend-bg); color: #7f8c8d; cursor: not-allowed; }
        .holiday { background-color: var(--holiday-color); color: white; cursor: not-allowed; }
        .convenio { background-color: var(--convenio-color); color: white; cursor: not-allowed; }
        
        /* Nuevo estado: Fuera de rango */
        .out-of-range {
            background-color: #e0e0e0;
            color: #a0a0a0;
            cursor: not-allowed;
            opacity: 0.6;
            text-decoration: line-through;
        }

        .vac-prio { background-color: var(--prio-color) !important; color: white; }
        .vac-flex { background-color: var(--flex-color) !important; color: #003; }

        /* Tooltip */
        .holiday:hover::after, .convenio:hover::after {
            content: attr(data-title);
            position: absolute;
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 10;
            margin-top: -30px;
            pointer-events: none;
        }

        /* Input oculto para cargar archivo */
        #fileInput { display: none; }
    </style>
</head>
<body>

    <h1>Vacaciones 2026</h1>

    <div class="control-panel">
        <div class="inputs-row">
            <div class="input-group">
                <label>Total Vacaciones</label>
                <input type="number" id="totalInput" value="23" min="0" oninput="calculateDays(); saveLocal();">
            </div>
            <div class="input-group">
                <label>Prioritarias (Max)</label>
                <input type="number" id="prioInput" readonly>
            </div>
            <div class="input-group">
                <label>Flexibles (Resto)</label>
                <input type="number" id="flexInput" readonly>
            </div>
        </div>

        <div class="counters">
            Uso Prioritarias: <strong id="countPrio">0</strong> | 
            Uso Flexibles: <strong id="countFlex">0</strong>
        </div>

        <div class="mode-selector">
            <span><strong>Herramientas:</strong></span>
            <button class="mode-btn btn-prio active" onclick="setMode('prio')">Prioritarias</button>
            <button class="mode-btn btn-flex" onclick="setMode('flex')">Flexibles</button>
            <button class="mode-btn btn-erase" onclick="setMode('erase')">Borrar</button>
            
            <div style="width: 20px;"></div> <button class="mode-btn btn-save" onclick="downloadData()">游 Guardar Datos</button>
            <button class="mode-btn btn-load" onclick="document.getElementById('fileInput').click()">游늭 Cargar Datos</button>
            <input type="file" id="fileInput" accept=".json" onchange="loadFromFile(this)">
        </div>
        <div style="font-size: 0.8em; color: #888;">* Solo se pueden marcar vacaciones hasta el 15 de enero de 2027.</div>
    </div>

    <div class="calendar-grid" id="calendar"></div>

    <script>
        const baseYear = 2026;
        let currentMode = 'prio'; 
        
        const holidays = {
            "0-1": { name: "A침o Nuevo", type: "holiday" },
            "0-6": { name: "D칤a de Reyes", type: "holiday" },
            "2-19": { name: "San Jos칠", type: "holiday" },
            "2-28": { name: "La Reconquista", type: "holiday" },
            "3-2":  { name: "Jueves Santo", type: "holiday" },
            "3-3":  { name: "Viernes Santo", type: "holiday" },
            "4-1":  { name: "Fiesta del Trabajo", type: "holiday" },
            "5-24": { name: "San Xo치n", type: "holiday" },
            "6-25": { name: "D칤a Nacional de Galicia", type: "holiday" },
            "7-15": { name: "Asunci칩n de la Virgen", type: "holiday" },
            "7-17": { name: "San Roque", type: "holiday" },
            "9-12": { name: "Fiesta Nacional de Espa침a", type: "holiday" },
            "11-8": { name: "Inmaculada Concepci칩n", type: "holiday" },
            "11-24": { name: "Nochebuena", type: "convenio" },
            "11-25": { name: "Navidad", type: "holiday" },
            "11-31": { name: "Fin de a침o", type: "convenio" }
        };

        const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
        const dayNames = ["L", "M", "X", "J", "V", "S", "D"];

        // Elementos del DOM
        const calendarContainer = document.getElementById('calendar');
        const totalInput = document.getElementById('totalInput');
        const prioInput = document.getElementById('prioInput');
        const flexInput = document.getElementById('flexInput');
        const countPrioDisplay = document.getElementById('countPrio');
        const countFlexDisplay = document.getElementById('countFlex');

        // --- FUNCIONES PRINCIPALES ---

        function calculateDays() {
            let total = parseInt(totalInput.value) || 0;
            let prio = (total < 15) ? total : 15;
            let flex = total - prio;
            prioInput.value = prio;
            flexInput.value = flex;
            updateCounters();
        }

        // Cambio de modo (Pincel)
        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            if(mode === 'prio') document.querySelector('.btn-prio').classList.add('active');
            if(mode === 'flex') document.querySelector('.btn-flex').classList.add('active');
            if(mode === 'erase') document.querySelector('.btn-erase').classList.add('active');
        }

        // Contar d칤as marcados
        function updateCounters() {
            const prioUsed = document.querySelectorAll('.vac-prio').length;
            const flexUsed = document.querySelectorAll('.vac-flex').length;
            const prioLimit = parseInt(prioInput.value);
            const flexLimit = parseInt(flexInput.value);

            countPrioDisplay.textContent = `${prioUsed} / ${prioLimit}`;
            countFlexDisplay.textContent = `${flexUsed} / ${flexLimit}`;

            // Alertas visuales (color rojo si te pasas)
            countPrioDisplay.style.color = (prioUsed > prioLimit) ? 'red' : '#666';
            countFlexDisplay.style.color = (flexUsed > flexLimit) ? 'red' : '#666';
        }

        // Click en un d칤a
        function handleDayClick(e) {
            const el = e.target;
            
            // Si es festivo, fin de semana o vac칤o, no hacer nada
            if (el.classList.contains('holiday') || 
                el.classList.contains('convenio') || 
                el.classList.contains('weekend') ||
                el.classList.contains('out-of-range') || // Bloquear si est치 fuera de rango
                !el.classList.contains('day')) {
                return;
            }

            // Identificador 칰nico para guardar (a침o-mes-dia)
            // Ya que tenemos 2026 y 2027, necesitamos saber el a침o.
            // Lo recuperamos del atributo data o del contexto, pero como se generan din치micamente:
            // Vamos a a침adir un atributo data-id al generar el calendario para facilitar esto.

            if (currentMode === 'erase') {
                el.classList.remove('vac-prio', 'vac-flex');
            } else if (currentMode === 'prio') {
                el.classList.remove('vac-flex');
                el.classList.toggle('vac-prio');
            } else if (currentMode === 'flex') {
                el.classList.remove('vac-prio');
                el.classList.toggle('vac-flex');
            }
            
            updateCounters();
            saveLocal();
        }

        // Generar Calendario
        function initCalendar() {
            calendarContainer.innerHTML = ''; 
            const totalMonthsToRender = 13;

            for (let i = 0; i < totalMonthsToRender; i++) {
                let currentYear = baseYear;
                let monthIndex = i;

                if (i === 12) {
                    currentYear = baseYear + 1;
                    monthIndex = 0;
                }

                const monthDiv = document.createElement('div');
                monthDiv.className = 'month';

                const header = document.createElement('div');
                header.className = 'month-header';
                if (currentYear > baseYear) {
                    header.textContent = `${monthNames[monthIndex]} ${currentYear}`;
                    header.classList.add('next-year');
                } else {
                    header.textContent = monthNames[monthIndex];
                }
                
                monthDiv.appendChild(header);

                 // Grid de d칤as
                const daysGrid = document.createElement('div');
                daysGrid.className = 'days-grid';

                // Nombres de los d칤as (L M X...)
                dayNames.forEach(day => {
                    const d = document.createElement('div');
                    d.className = 'day-name';
                    d.textContent = day;
                    daysGrid.appendChild(d);
                });

                const firstDay = new Date(currentYear, monthIndex, 1);
                const daysInMonth = new Date(currentYear, monthIndex + 1, 0).getDate();
                let startDayIndex = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;

                for (let k = 0; k < startDayIndex; k++) {
                    daysGrid.appendChild(document.createElement('div'));
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'day';
                    dayDiv.textContent = day;
                    dayDiv.onclick = handleDayClick;
                    
                    // ID 칔nico para guardar estado: YYYY-MM-DD
                    const uniqueId = `${currentYear}-${monthIndex}-${day}`;
                    dayDiv.setAttribute('id', uniqueId);

                    const currentDayObj = new Date(currentYear, monthIndex, day);
                    const dayOfWeek = currentDayObj.getDay();

                    // Fin de semana
                    if (dayOfWeek === 0 || dayOfWeek === 6) {
                        dayDiv.classList.add('weekend');
                    }

                    // 2. Limite 15 Enero 2027
                    // Si es 2027 (monthIndex 0 es Enero) y dia > 15
                    if (currentYear === 2027 && day > 15) {
                        dayDiv.classList.add('out-of-range');
                        dayDiv.title = "Fuera de plazo permitido";
                    }

                    // 3. Festivos
                    const holidayKey = `${monthIndex}-${day}`;
                    if (holidays[holidayKey]) {
                        dayDiv.classList.add(holidays[holidayKey].type);
                        dayDiv.setAttribute('data-title', holidays[holidayKey].name);
                    }

                    daysGrid.appendChild(dayDiv);
                }
                
                monthDiv.appendChild(daysGrid);
                calendarContainer.appendChild(monthDiv);
            }
            
            // Despu칠s de generar el HTML, cargamos los datos guardados
            loadLocal();
        }

        // --- SISTEMA DE GUARDADO ---

        // 1. Guardar en LocalStorage
        function saveLocal() {
            const data = {
                totalDays: totalInput.value,
                prioDays: [],
                flexDays: []
            };

            // Buscar todos los d칤as marcados
            document.querySelectorAll('.vac-prio').forEach(el => data.prioDays.push(el.id));
            document.querySelectorAll('.vac-flex').forEach(el => data.flexDays.push(el.id));
            localStorage.setItem('vacaciones2026', JSON.stringify(data));
        }

        // 2. Cargar de LocalStorage
        function loadLocal() {
            const saved = localStorage.getItem('vacaciones2026');
            if (saved) {
                applyData(JSON.parse(saved));
            }
        }

        // 3. Aplicar datos al DOM
        function applyData(data) {
            if (!data) return;

            // Restaurar input total
            if (data.totalDays) {
                totalInput.value = data.totalDays;
                calculateDays();
            }

            // Limpiar marcas actuales
            document.querySelectorAll('.vac-prio, .vac-flex').forEach(el => {
                el.classList.remove('vac-prio', 'vac-flex');
            });

            // Pintar Prioritarias
            if (data.prioDays) {
                data.prioDays.forEach(id => {
                    const el = document.getElementById(id);
                    if (el && !el.classList.contains('out-of-range')) el.classList.add('vac-prio');
                });
            }

            // Pintar Flexibles
            if (data.flexDays) {
                data.flexDays.forEach(id => {
                    const el = document.getElementById(id);
                    if (el && !el.classList.contains('out-of-range')) el.classList.add('vac-flex');
                });
            }
            updateCounters();
        }

        // 4. Descargar archivo JSON (Backup)
        function downloadData() {
            saveLocal();
            const rawData = localStorage.getItem('vacaciones2026');
            const blob = new Blob([rawData], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = "mis_vacaciones_2026.json";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // 5. Cargar desde archivo
        function loadFromFile(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    applyData(data);
                    saveLocal(); // Guardar lo cargado en memoria local
                    alert("Datos cargados correctamente.");
                } catch (err) {
                    alert("Error al leer el archivo. Aseg칰rate de que es el correcto.");
                }
            };
            reader.readAsText(file);
            input.value = ''; // Reset input
        }

        // Inicializaci칩n
        calculateDays();
        initCalendar();

    </script>
</body>
</html>